<!DOCTYPE html>
<html lang="zh-TW">
<head><script type='text/javascript' src='https://bhe3a9h638j3jas6.canva-hosted-embed.com/AUSSs8kf2OfMD9QAx_MpEerPMwkSKBJhB1Yx5uEgnEvX-oqTBx9TZbedLjdQ4ZWfgvdTjT0DqwnnvOxAlKO08Q=='></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êù±ÂçóÈäòÁâàÊúâÈôêÂÖ¨Âè∏ - Ë®òÂ∏≥ÁÆ°ÁêÜÁ≥ªÁµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --secondary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --success-gradient: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        /* Ê∑±Ëâ≤‰∏ªÈ°å */
        body.dark-theme {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }

        /* Ê∑∫Ëâ≤‰∏ªÈ°å */
        body.light-theme {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dark-theme .header {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .light-theme .header {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--primary-gradient);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab-button {
            background: var(--primary-gradient);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tab-button.active {
            background: var(--secondary-gradient);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .dark-theme .card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .light-theme .card {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .dark-theme .form-group input,
        .dark-theme .form-group select,
        .dark-theme .form-group textarea {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .light-theme .form-group input,
        .light-theme .form-group select,
        .light-theme .form-group textarea {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }

        .btn {
            background: var(--primary-gradient);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-danger {
            background: var(--danger-gradient);
        }

        .btn-success {
            background: var(--success-gradient);
        }

        .btn-secondary {
            background: var(--secondary-gradient);
        }

        .record-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .dark-theme .record-item {
            background: rgba(255, 255, 255, 0.05);
        }

        .light-theme .record-item {
            background: rgba(255, 255, 255, 0.5);
        }

        .record-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .income {
            color: #28a745;
            font-weight: bold;
        }

        .expense {
            color: #dc3545;
            font-weight: bold;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }

        .notification.success {
            background: var(--success-gradient);
        }

        .notification.error {
            background: var(--danger-gradient);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .dark-theme .stat-card {
            background: rgba(255, 255, 255, 0.1);
        }

        .light-theme .stat-card {
            background: rgba(255, 255, 255, 0.3);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .category-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .dark-theme .category-item {
            background: rgba(255, 255, 255, 0.1);
        }

        .light-theme .category-item {
            background: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-button {
                width: 100%;
                margin: 5px 0;
            }
            
            .record-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <button class="theme-toggle" onclick="toggleTheme()">üåô ÂàáÊèõ‰∏ªÈ°å</button>
    
    <div class="container">
        <div class="header">
            <h1>Êù±ÂçóÈäòÁâàÊúâÈôêÂÖ¨Âè∏</h1>
            <h2>Ë®òÂ∏≥ÁÆ°ÁêÜÁ≥ªÁµ±</h2>
            <p>Â∞àÊ•≠ÁöÑË≤°ÂãôÁÆ°ÁêÜËß£Ê±∫ÊñπÊ°à</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('accounting')">Ë®òÂ∏≥ÁÆ°ÁêÜ</button>
            <button class="tab-button" onclick="showTab('categories')">ÂàÜÈ°ûÁÆ°ÁêÜ</button>
            <button class="tab-button" onclick="showTab('records')">Ë®òÂ∏≥ÊòéÁ¥∞</button>
            <button class="tab-button" onclick="showTab('statistics')">Áµ±Ë®àÂàÜÊûê</button>
            <button class="tab-button" onclick="showTab('export')">Ë≥áÊñôÂåØÂá∫</button>
        </div>

        <!-- Ë®òÂ∏≥ÁÆ°ÁêÜ -->
        <div id="accounting" class="tab-content active">
            <div class="card">
                <h3>Êñ∞Â¢ûË®òÂ∏≥Ë®òÈåÑ</h3>
                <form id="accountingForm">
                    <div class="form-group">
                        <label for="amount">ÈáëÈ°ç</label>
                        <input type="number" id="amount" required min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="type">È°ûÂûã</label>
                        <select id="type" required>
                            <option value="">Ë´ãÈÅ∏ÊìáÈ°ûÂûã</option>
                            <option value="income">Êî∂ÂÖ•</option>
                            <option value="expense">ÊîØÂá∫</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="category">ÂàÜÈ°û</label>
                        <select id="category" required>
                            <option value="">Ë´ãÈÅ∏ÊìáÂàÜÈ°û</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="date">Êó•Êúü</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="form-group">
                        <label for="note">ÂÇôË®ª</label>
                        <textarea id="note" rows="3" placeholder="Ë´ãËº∏ÂÖ•ÂÇôË®ª..."></textarea>
                    </div>
                    <button type="submit" class="btn">Êñ∞Â¢ûË®òÈåÑ</button>
                </form>
            </div>
        </div>

        <!-- ÂàÜÈ°ûÁÆ°ÁêÜ -->
        <div id="categories" class="tab-content">
            <div class="card">
                <h3>Êñ∞Â¢ûÂàÜÈ°û</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="newCategory" placeholder="Ëº∏ÂÖ•Êñ∞ÂàÜÈ°ûÂêçÁ®±..." style="flex: 1;">
                    <button class="btn" onclick="addCategory()">Êñ∞Â¢ûÂàÜÈ°û</button>
                </div>
                <div class="category-list" id="categoryList"></div>
            </div>
        </div>

        <!-- Ë®òÂ∏≥ÊòéÁ¥∞ -->
        <div id="records" class="tab-content">
            <div class="card">
                <h3>Ë®òÂ∏≥ÊòéÁ¥∞Êü•Ë©¢</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <input type="date" id="startDate" style="flex: 1; min-width: 150px;">
                    <input type="date" id="endDate" style="flex: 1; min-width: 150px;">
                    <button class="btn" onclick="filterRecords()">ÁØ©ÈÅ∏</button>
                    <button class="btn btn-secondary" onclick="clearFilter()">Ê∏ÖÈô§ÁØ©ÈÅ∏</button>
                </div>
                <div class="record-list" id="recordList"></div>
            </div>
        </div>

        <!-- Áµ±Ë®àÂàÜÊûê -->
        <div id="statistics" class="tab-content">
            <div class="card">
                <h3>Áµ±Ë®àÂàÜÊûê</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <select id="statsType" style="flex: 1; min-width: 150px;">
                        <option value="category">‰æùÂàÜÈ°ûÁµ±Ë®à</option>
                        <option value="month">‰æùÊúà‰ªΩÁµ±Ë®à</option>
                        <option value="date">‰æùÊó•ÊúüÁµ±Ë®à</option>
                    </select>
                    <input type="date" id="statsStartDate" style="flex: 1; min-width: 150px;">
                    <input type="date" id="statsEndDate" style="flex: 1; min-width: 150px;">
                    <button class="btn" onclick="generateStats()">ÁîüÊàêÁµ±Ë®à</button>
                </div>
                
                <div class="stats-grid" id="statsGrid"></div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <select id="chartType">
                        <option value="pie">ÂúìÈ§ÖÂúñ</option>
                        <option value="bar">Êü±ÁãÄÂúñ</option>
                    </select>
                    <button class="btn btn-success" onclick="downloadChart('jpg')">‰∏ãËºâ JPG</button>
                    <button class="btn btn-success" onclick="downloadChart('svg')">‰∏ãËºâ SVG</button>
                </div>
                
                <div class="chart-container">
                    <canvas id="statsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Ë≥áÊñôÂåØÂá∫ -->
        <div id="export" class="tab-content">
            <div class="card">
                <h3>Ë≥áÊñôÂåØÂá∫</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <input type="date" id="exportStartDate" style="flex: 1; min-width: 150px;">
                    <input type="date" id="exportEndDate" style="flex: 1; min-width: 150px;">
                    <button class="btn btn-success" onclick="exportData('txt')">ÂåØÂá∫ TXT</button>
                    <button class="btn btn-success" onclick="exportData('csv')">ÂåØÂá∫ CSV</button>
                </div>
                <div id="exportPreview" style="max-height: 300px; overflow-y: auto; padding: 15px; border-radius: 10px; font-family: monospace;"></div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let records = JSON.parse(localStorage.getItem('records')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || [
            'È§êÈ£≤', '‰∫§ÈÄöË≤ª', 'ÊñáÂÖ∑', 'Ë¨õÂ∏´Ë≤ª', 'ÊàøÁßü', 'Ê∞¥ÈõªË≤ª', 'ÈõªË©±Ë≤ª', 'Á∂≤Ë∑ØË≤ª',
            '‰øùÈö™Ë≤ª', 'ÈÜ´ÁôÇË≤ª', 'Â®õÊ®Ç', 'Ë≥ºÁâ©', 'ÊóÖÈÅä', 'ÊïôËÇ≤', 'ÊäïË≥á', 'Ëñ™Ë≥á',
            'ÁçéÈáë', 'Âà©ÊÅØ', 'ÂÖ∂‰ªñÊî∂ÂÖ•', 'ÂÖ∂‰ªñÊîØÂá∫'
        ];
        let currentChart = null;

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Ë®≠ÂÆöÁï∂ÂâçÊó•Êúü
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            document.getElementById('statsStartDate').value = today;
            document.getElementById('statsEndDate').value = today;
            document.getElementById('exportStartDate').value = today;
            document.getElementById('exportEndDate').value = today;

            // ËºâÂÖ•‰∏ªÈ°åË®≠ÂÆö
            const savedTheme = localStorage.getItem('theme') || 'dark-theme';
            document.body.className = savedTheme;
            updateThemeToggle();

            // ÂàùÂßãÂåñÂêÑÂäüËÉΩ
            loadCategories();
            loadRecords();
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('accountingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addRecord();
            });
        }

        // ‰∏ªÈ°åÂàáÊèõ
        function toggleTheme() {
            const body = document.body;
            if (body.classList.contains('dark-theme')) {
                body.className = 'light-theme';
                localStorage.setItem('theme', 'light-theme');
            } else {
                body.className = 'dark-theme';
                localStorage.setItem('theme', 'dark-theme');
            }
            updateThemeToggle();
        }

        function updateThemeToggle() {
            const toggle = document.querySelector('.theme-toggle');
            if (document.body.classList.contains('dark-theme')) {
                toggle.innerHTML = '‚òÄÔ∏è Ê∑∫Ëâ≤‰∏ªÈ°å';
            } else {
                toggle.innerHTML = 'üåô Ê∑±Ëâ≤‰∏ªÈ°å';
            }
        }

        // È†ÅÁ±§ÂàáÊèõ
        function showTab(tabName) {
            // Èö±ËóèÊâÄÊúâÈ†ÅÁ±§ÂÖßÂÆπ
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // ÁßªÈô§ÊâÄÊúâÊåâÈàïÁöÑ active È°ûÂà•
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));

            // È°ØÁ§∫ÈÅ∏‰∏≠ÁöÑÈ†ÅÁ±§
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // ÁâπÊÆäËôïÁêÜ
            if (tabName === 'records') {
                loadRecords();
            } else if (tabName === 'categories') {
                loadCategories();
            }
        }

        // ÈÄöÁü•Á≥ªÁµ±
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Ë®òÂ∏≥ÂäüËÉΩ
        function addRecord() {
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;
            const note = document.getElementById('note').value;

            if (!amount || !type || !category || !date) {
                showNotification('Ë´ãÂ°´ÂØ´ÊâÄÊúâÂøÖÂ°´Ê¨Ñ‰Ωç', 'error');
                return;
            }

            const record = {
                id: Date.now(),
                amount: type === 'expense' ? -amount : amount,
                type,
                category,
                date,
                note,
                timestamp: new Date().toISOString()
            };

            records.push(record);
            localStorage.setItem('records', JSON.stringify(records));
            
            // Ê∏ÖÁ©∫Ë°®ÂñÆ
            document.getElementById('accountingForm').reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            
            showNotification('Ë®òÈåÑÊñ∞Â¢ûÊàêÂäüÔºÅ');
        }

        // ÂàÜÈ°ûÁÆ°ÁêÜ
        function loadCategories() {
            const categorySelect = document.getElementById('category');
            const categoryList = document.getElementById('categoryList');
            
            // Êõ¥Êñ∞‰∏ãÊãâÈÅ∏ÂñÆ
            categorySelect.innerHTML = '<option value="">Ë´ãÈÅ∏ÊìáÂàÜÈ°û</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            // Êõ¥Êñ∞ÂàÜÈ°ûÂàóË°®
            if (categoryList) {
                categoryList.innerHTML = '';
                categories.forEach(category => {
                    const item = document.createElement('div');
                    item.className = 'category-item';
                    item.innerHTML = `
                        <span>${category}</span>
                        <button class="btn btn-danger" onclick="deleteCategory('${category}')">Âà™Èô§</button>
                    `;
                    categoryList.appendChild(item);
                });
            }
        }

        function addCategory() {
            const newCategory = document.getElementById('newCategory').value.trim();
            
            if (!newCategory) {
                showNotification('Ë´ãËº∏ÂÖ•ÂàÜÈ°ûÂêçÁ®±', 'error');
                return;
            }

            if (categories.includes(newCategory)) {
                showNotification('ÂàÜÈ°ûÂ∑≤Â≠òÂú®', 'error');
                return;
            }

            categories.push(newCategory);
            localStorage.setItem('categories', JSON.stringify(categories));
            document.getElementById('newCategory').value = '';
            loadCategories();
            showNotification('ÂàÜÈ°ûÊñ∞Â¢ûÊàêÂäüÔºÅ');
        }

        function deleteCategory(category) {
            if (confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ÂàÜÈ°û„Äå${category}„ÄçÂóéÔºü`)) {
                categories = categories.filter(c => c !== category);
                localStorage.setItem('categories', JSON.stringify(categories));
                loadCategories();
                showNotification('ÂàÜÈ°ûÂà™Èô§ÊàêÂäüÔºÅ');
            }
        }

        // Ë®òÈåÑÁÆ°ÁêÜ
        function loadRecords() {
            const recordList = document.getElementById('recordList');
            if (!recordList) return;

            recordList.innerHTML = '';
            
            // ÊåâÊó•ÊúüÂÄíÂ∫èÊéíÂàó
            const sortedRecords = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedRecords.forEach(record => {
                const item = document.createElement('div');
                item.className = 'record-item';
                
                const amountClass = record.amount > 0 ? 'income' : 'expense';
                const amountText = record.amount > 0 ? `+${record.amount}` : record.amount;
                
                item.innerHTML = `
                    <div>
                        <div><strong>${record.category}</strong></div>
                        <div>${record.date}</div>
                        <div>${record.note || 'ÁÑ°ÂÇôË®ª'}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="${amountClass}">$${amountText}</div>
                        <button class="btn btn-danger" onclick="deleteRecord(${record.id})">Âà™Èô§</button>
                    </div>
                `;
                recordList.appendChild(item);
            });
        }

        function deleteRecord(id) {
            if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜË®òÈåÑÂóéÔºü')) {
                records = records.filter(record => record.id !== id);
                localStorage.setItem('records', JSON.stringify(records));
                loadRecords();
                showNotification('Ë®òÈåÑÂà™Èô§ÊàêÂäüÔºÅ');
            }
        }

        function filterRecords() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                showNotification('Ë´ãÈÅ∏ÊìáÊó•ÊúüÁØÑÂúç', 'error');
                return;
            }

            const recordList = document.getElementById('recordList');
            recordList.innerHTML = '';
            
            const filteredRecords = records.filter(record => {
                return record.date >= startDate && record.date <= endDate;
            }).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredRecords.forEach(record => {
                const item = document.createElement('div');
                item.className = 'record-item';
                
                const amountClass = record.amount > 0 ? 'income' : 'expense';
                const amountText = record.amount > 0 ? `+${record.amount}` : record.amount;
                
                item.innerHTML = `
                    <div>
                        <div><strong>${record.category}</strong></div>
                        <div>${record.date}</div>
                        <div>${record.note || 'ÁÑ°ÂÇôË®ª'}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="${amountClass}">$${amountText}</div>
                        <button class="btn btn-danger" onclick="deleteRecord(${record.id})">Âà™Èô§</button>
                    </div>
                `;
                recordList.appendChild(item);
            });
            
            showNotification(`ÊâæÂà∞ ${filteredRecords.length} Á≠ÜË®òÈåÑ`);
        }

        function clearFilter() {
            loadRecords();
            showNotification('ÁØ©ÈÅ∏Â∑≤Ê∏ÖÈô§');
        }

        // Áµ±Ë®àÂàÜÊûê
        function generateStats() {
            const statsType = document.getElementById('statsType').value;
            const startDate = document.getElementById('statsStartDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            
            if (!startDate || !endDate) {
                showNotification('Ë´ãÈÅ∏ÊìáÁµ±Ë®àÊó•ÊúüÁØÑÂúç', 'error');
                return;
            }

            const filteredRecords = records.filter(record => {
                return record.date >= startDate && record.date <= endDate;
            });

            let statsData = {};
            let labels = [];
            let values = [];

            if (statsType === 'category') {
                filteredRecords.forEach(record => {
                    if (!statsData[record.category]) {
                        statsData[record.category] = 0;
                    }
                    statsData[record.category] += Math.abs(record.amount);
                });
            } else if (statsType === 'month') {
                filteredRecords.forEach(record => {
                    const month = record.date.substring(0, 7);
                    if (!statsData[month]) {
                        statsData[month] = 0;
                    }
                    statsData[month] += Math.abs(record.amount);
                });
            } else if (statsType === 'date') {
                filteredRecords.forEach(record => {
                    if (!statsData[record.date]) {
                        statsData[record.date] = 0;
                    }
                    statsData[record.date] += Math.abs(record.amount);
                });
            }

            labels = Object.keys(statsData);
            values = Object.values(statsData);

            // Êõ¥Êñ∞Áµ±Ë®àÂç°Áâá
            updateStatsGrid(filteredRecords);
            
            // ÁîüÊàêÂúñË°®
            generateChart(labels, values, statsType);
        }

        function updateStatsGrid(filteredRecords) {
            const statsGrid = document.getElementById('statsGrid');
            
            const totalIncome = filteredRecords.filter(r => r.amount > 0).reduce((sum, r) => sum + r.amount, 0);
            const totalExpense = filteredRecords.filter(r => r.amount < 0).reduce((sum, r) => sum + Math.abs(r.amount), 0);
            const balance = totalIncome - totalExpense;
            const recordCount = filteredRecords.length;

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value income">$${totalIncome.toFixed(2)}</div>
                    <div>Á∏ΩÊî∂ÂÖ•</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value expense">$${totalExpense.toFixed(2)}</div>
                    <div>Á∏ΩÊîØÂá∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: ${balance >= 0 ? '#28a745' : '#dc3545'}">$${balance.toFixed(2)}</div>
                    <div>Ê∑®Êî∂ÊîØ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${recordCount}</div>
                    <div>Ë®òÈåÑÁ≠ÜÊï∏</div>
                </div>
            `;
        }

        function generateChart(labels, values, statsType) {
            const ctx = document.getElementById('statsChart').getContext('2d');
            const chartType = document.getElementById('chartType').value;
            
            if (currentChart) {
                currentChart.destroy();
            }

            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
            ];

            currentChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ÈáëÈ°ç',
                        data: values,
                        backgroundColor: colors.slice(0, labels.length),
                        borderColor: colors.slice(0, labels.length),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${getStatsTypeText(statsType)}Áµ±Ë®àÂúñË°®`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: chartType === 'pie'
                        }
                    },
                    scales: chartType === 'bar' ? {
                        y: {
                            beginAtZero: true
                        }
                    } : {}
                }
            });
        }

        function getStatsTypeText(type) {
            switch(type) {
                case 'category': return 'ÂàÜÈ°û';
                case 'month': return 'Êúà‰ªΩ';
                case 'date': return 'Êó•Êúü';
                default: return '';
            }
        }

        // ÂúñË°®‰∏ãËºâ
        function downloadChart(format) {
            if (!currentChart) {
                showNotification('Ë´ãÂÖàÁîüÊàêÁµ±Ë®àÂúñË°®', 'error');
                return;
            }

            const canvas = document.getElementById('statsChart');
            const statsType = document.getElementById('statsType').value;
            const filename = `Áµ±Ë®àÂúñË°®_${getStatsTypeText(statsType)}_${new Date().toISOString().split('T')[0]}`;

            if (format === 'jpg') {
                // ÂâµÂª∫Êñ∞ÁöÑ canvas Âä†‰∏äÁôΩËâ≤ËÉåÊôØ
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                
                // Â°´ÂÖÖÁôΩËâ≤ËÉåÊôØ
                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                
                // Áπ™Ë£ΩÂéüÂúñË°®
                tempCtx.drawImage(canvas, 0, 0);
                
                const link = document.createElement('a');
                link.download = `${filename}.jpg`;
                link.href = tempCanvas.toDataURL('image/jpeg', 0.9);
                link.click();
            } else if (format === 'svg') {
                // SVG ‰∏ãËºâÈúÄË¶ÅÈáçÊñ∞ÂØ¶ÁèæÔºåÈÄôË£°‰ΩøÁî® PNG Êõø‰ª£
                const link = document.createElement('a');
                link.download = `${filename}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
            
            showNotification(`ÂúñË°®Â∑≤‰∏ãËºâÁÇ∫ ${format.toUpperCase()} Ê†ºÂºè`);
        }

        // Ë≥áÊñôÂåØÂá∫
        function exportData(format) {
            const startDate = document.getElementById('exportStartDate').value;
            const endDate = document.getElementById('exportEndDate').value;
            
            if (!startDate || !endDate) {
                showNotification('Ë´ãÈÅ∏ÊìáÂåØÂá∫Êó•ÊúüÁØÑÂúç', 'error');
                return;
            }

            const filteredRecords = records.filter(record => {
                return record.date >= startDate && record.date <= endDate;
            }).sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filteredRecords.length === 0) {
                showNotification('ÈÅ∏ÂÆöÊó•ÊúüÁØÑÂúçÂÖßÁÑ°Ë®òÈåÑ', 'error');
                return;
            }

            let content = '';
            const filename = `Ë®òÂ∏≥ÊòéÁ¥∞_${startDate}_${endDate}`;

            if (format === 'txt') {
                content = 'Êù±ÂçóÈäòÁâàÊúâÈôêÂÖ¨Âè∏ - Ë®òÂ∏≥ÊòéÁ¥∞\n';
                content += `ÂåØÂá∫Êó•ÊúüÔºö${new Date().toLocaleDateString()}\n`;
                content += `Ë≥áÊñôÁØÑÂúçÔºö${startDate} Ëá≥ ${endDate}\n`;
                content += '='.repeat(50) + '\n\n';
                
                filteredRecords.forEach(record => {
                    content += `Êó•ÊúüÔºö${record.date}\n`;
                    content += `ÂàÜÈ°ûÔºö${record.category}\n`;
                    content += `È°ûÂûãÔºö${record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}\n`;
                    content += `ÈáëÈ°çÔºö$${Math.abs(record.amount)}\n`;
                    content += `ÂÇôË®ªÔºö${record.note || 'ÁÑ°'}\n`;
                    content += '-'.repeat(30) + '\n';
                });
            } else if (format === 'csv') {
                content = 'Êó•Êúü,ÂàÜÈ°û,È°ûÂûã,ÈáëÈ°ç,ÂÇôË®ª\n';
                filteredRecords.forEach(record => {
                    content += `${record.date},${record.category},${record.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'},${Math.abs(record.amount)},"${record.note || ''}"\n`;
                });
            }

            // È°ØÁ§∫È†êË¶Ω
            const preview = document.getElementById('exportPreview');
            preview.innerHTML = `<pre>${content}</pre>`;

            // ‰∏ãËºâÊ™îÊ°à
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}.${format}`;
            link.click();
            
            showNotification(`Ë≥áÊñôÂ∑≤ÂåØÂá∫ÁÇ∫ ${format.toUpperCase()} Ê†ºÂºè`);
        }

        // Èò≤ÊäñÂáΩÊï∏
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'966226e6517a8421',t:'MTc1MzY4MjM4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
